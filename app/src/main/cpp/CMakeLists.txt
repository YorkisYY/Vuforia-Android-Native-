cmake_minimum_required(VERSION 3.22.1)
project("vuforia_wrapper")
#C:\Users\USER\Desktop\IBM-WEATHER-ART-ANDRIOD\app\src\main\cpp\CMakeLists.txt
# ==================== ç·¨è­¯å™¨å’Œæ¨™æº–è¨­ç½® ====================
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# ==================== å»ºæ§‹é¡å‹æª¢æŸ¥ ====================
if(NOT CMAKE_BUILD_TYPE)
    set(CMAKE_BUILD_TYPE Release)
endif()

message(STATUS "Build type: ${CMAKE_BUILD_TYPE}")
message(STATUS "Target ABI: ${ANDROID_ABI}")

# ==================== Vuforia è·¯å¾‘é…ç½® ====================
# Vuforia é ­æ–‡ä»¶è·¯å¾‘ - æ ¹æ“šä½ çš„å¯¦éš›çµæ§‹
set(VUFORIA_INCLUDE_DIR ${CMAKE_SOURCE_DIR}/include)
set(VUFORIA_ENGINE_INCLUDE_DIR ${CMAKE_SOURCE_DIR}/include/VuforiaEngine)

# Vuforia åº«æ–‡ä»¶è·¯å¾‘
set(VUFORIA_LIBRARY_DIR ${CMAKE_SOURCE_DIR}/../jniLibs/${ANDROID_ABI})

# æª¢æŸ¥è·¯å¾‘æ˜¯å¦å­˜åœ¨
if(NOT EXISTS ${VUFORIA_INCLUDE_DIR})
    message(FATAL_ERROR "Vuforia include directory not found: ${VUFORIA_INCLUDE_DIR}")
endif()

if(NOT EXISTS ${VUFORIA_ENGINE_INCLUDE_DIR}/VuforiaEngine.h)
    message(FATAL_ERROR "VuforiaEngine.h not found: ${VUFORIA_ENGINE_INCLUDE_DIR}/VuforiaEngine.h")
endif()

if(NOT EXISTS ${VUFORIA_LIBRARY_DIR}/libVuforia.so)
    message(FATAL_ERROR "Vuforia library not found: ${VUFORIA_LIBRARY_DIR}/libVuforia.so")
endif()

message(STATUS "Vuforia include dir: ${VUFORIA_INCLUDE_DIR}")
message(STATUS "Vuforia engine include dir: ${VUFORIA_ENGINE_INCLUDE_DIR}")
message(STATUS "Vuforia library dir: ${VUFORIA_LIBRARY_DIR}")

# ==================== æºæ–‡ä»¶é…ç½®æ›´æ–° ====================
# æª¢æŸ¥æºæ–‡ä»¶
set(VUFORIA_WRAPPER_SOURCES)

# ä¸»è¦çš„wrapperå¯¦ç¾æ–‡ä»¶
if(EXISTS ${CMAKE_SOURCE_DIR}/vuforia_wrapper.cpp)
    list(APPEND VUFORIA_WRAPPER_SOURCES vuforia_wrapper.cpp)
    message(STATUS "âœ… Found: vuforia_wrapper.cpp")
else()
    message(FATAL_ERROR "âŒ vuforia_wrapper.cpp not found - required main implementation file")
endif()

# æ–°å¢çš„æ¸²æŸ“JNIå°ˆç”¨æ–‡ä»¶
if(EXISTS ${CMAKE_SOURCE_DIR}/VuforiaRenderingJNI.cpp)
    list(APPEND VUFORIA_WRAPPER_SOURCES VuforiaRenderingJNI.cpp)
    message(STATUS "âœ… Found: VuforiaRenderingJNI.cpp (rendering JNI module)")
else()
    message(STATUS "âš ï¸ VuforiaRenderingJNI.cpp not found - will use inline JNI methods")
endif()

# æª¢æŸ¥é ­æ–‡ä»¶
if(EXISTS ${CMAKE_SOURCE_DIR}/VuforiaWrapper.h)
    message(STATUS "âœ… Found: VuforiaWrapper.h")
else()
    message(FATAL_ERROR "âŒ VuforiaWrapper.h not found - required header file")
endif()

if(EXISTS ${CMAKE_SOURCE_DIR}/VuforiaRenderingJNI.h)
    message(STATUS "âœ… Found: VuforiaRenderingJNI.h (rendering JNI header)")
else()
    message(STATUS "âš ï¸ VuforiaRenderingJNI.h not found - assuming inline declarations")
endif()

# é¡¯ç¤ºå°‡è¦ç·¨è­¯çš„æºæ–‡ä»¶
message(STATUS "ğŸ“ Source files to compile:")
foreach(SOURCE_FILE ${VUFORIA_WRAPPER_SOURCES})
    message(STATUS "   - ${SOURCE_FILE}")
endforeach()

# ==================== æ›´æ–°åŒ…å«ç›®éŒ„ ====================
# ç¢ºä¿æ–°çš„é ­æ–‡ä»¶èƒ½è¢«æ‰¾åˆ°
include_directories(
    ${VUFORIA_INCLUDE_DIR}
    ${VUFORIA_ENGINE_INCLUDE_DIR}
    ${CMAKE_SOURCE_DIR}  # åŒ…å« VuforiaWrapper.h å’Œ VuforiaRenderingJNI.h
    ${CMAKE_SOURCE_DIR}/include  # å¦‚æœé ­æ–‡ä»¶åœ¨ include å­ç›®éŒ„
)

# ==================== å‰µå»ºå…±äº«åº« ====================
add_library(vuforia_wrapper SHARED ${VUFORIA_WRAPPER_SOURCES})

# ==================== å°å…¥ Vuforia é ç·¨è­¯åº« ====================
add_library(Vuforia SHARED IMPORTED)
set_target_properties(Vuforia PROPERTIES
    IMPORTED_LOCATION ${VUFORIA_LIBRARY_DIR}/libVuforia.so
    INTERFACE_INCLUDE_DIRECTORIES ${VUFORIA_INCLUDE_DIR}
)

# ==================== æŸ¥æ‰¾ç³»çµ±åº« ====================
find_library(log-lib log)
find_library(android-lib android)
find_library(gles2-lib GLESv2)
find_library(egl-lib EGL)
find_library(jnigraphics-lib jnigraphics)
find_library(z-lib z)

# ==================== ç›¸æ©Ÿæ¬Šé™ç›¸é—œé…ç½® ====================
# ç›¸æ©Ÿç›¸é—œåº«
find_library(camera2-lib camera2ndk)
find_library(mediandk-lib mediandk)

# æª¢æŸ¥ç›¸æ©Ÿåº«æ˜¯å¦æ‰¾åˆ°
if(camera2-lib)
    message(STATUS "âœ… Camera2 NDK library found")
else()
    message(WARNING "âš ï¸ Camera2 NDK library not found - camera features may be limited")
endif()

if(mediandk-lib)
    message(STATUS "âœ… Media NDK library found")
else()
    message(WARNING "âš ï¸ Media NDK library not found - media features may be limited")
endif()

# æª¢æŸ¥é—œéµåº«æ˜¯å¦æ‰¾åˆ°
if(NOT log-lib)
    message(FATAL_ERROR "log library not found")
endif()

if(NOT android-lib)
    message(FATAL_ERROR "android library not found")
endif()

# ==================== ç·¨è­¯å®šç¾© ====================
target_compile_definitions(vuforia_wrapper PRIVATE
    # Android å¹³å°å®šç¾©
    ANDROID
    __ANDROID__
    VU_PLATFORM_ANDROID  # é‡è¦ï¼šè®“ Vuforia çŸ¥é“é€™æ˜¯ Android å¹³å°
    
    # OpenGL ç›¸é—œå®šç¾©
    GL_GLEXT_PROTOTYPES
    EGL_EGLEXT_PROTOTYPES
    
    # Vuforia ç‰¹å®šå®šç¾©
    VU_ANDROID
    
    # ç›¸æ©Ÿæ¬Šé™ç›¸é—œå®šç¾©
    CAMERA_PERMISSION_GRANTED
    CAMERA_FEATURE_ENABLED
    CAMERA_HARDWARE_ACCELERATED
    
    # C++ ç›¸é—œå®šç¾©
    _GNU_SOURCE
)

# ==================== ç·¨è­¯é¸é …é…ç½® ====================
target_compile_options(vuforia_wrapper PRIVATE
    # åŸºæœ¬ç·¨è­¯é¸é …
    -Wall
    -Wextra
    -Wno-unused-parameter
    -Wno-unused-variable
    
    # æ€§èƒ½å„ªåŒ–
    -ffast-math
    -fvisibility=hidden
    
    # èª¿è©¦ä¿¡æ¯ï¼ˆå³ä½¿åœ¨ Release æ¨¡å¼ä¸‹ä¹Ÿä¿ç•™ä¸€äº›èª¿è©¦ä¿¡æ¯ï¼‰
    -g
    
    # ARM ç‰¹å®šå„ªåŒ–
    $<$<STREQUAL:${ANDROID_ABI},armeabi-v7a>:-mfpu=neon>
    $<$<STREQUAL:${ANDROID_ABI},armeabi-v7a>:-marm>
    $<$<STREQUAL:${ANDROID_ABI},arm64-v8a>:-march=armv8-a>
    
    # ç›¸æ©Ÿç›¸é—œå„ªåŒ–
    -DCAMERA_PERFORMANCE_OPTIMIZED
    -DCAMERA_THREAD_SAFE
)

# ==================== Debug ç‰¹å®šé…ç½® ====================
if(CMAKE_BUILD_TYPE STREQUAL "Debug")
    target_compile_definitions(vuforia_wrapper PRIVATE
        DEBUG
        _DEBUG
        VU_DEBUG  # Vuforia èª¿è©¦å®šç¾©
    )
    
    target_compile_options(vuforia_wrapper PRIVATE
        -O0
        -fno-omit-frame-pointer
        -fno-inline-functions
        -DDEBUG_LEVEL=2
    )
    
    message(STATUS "Debug mode: Optimization disabled, debug symbols enabled")
endif()

# ==================== Release ç‰¹å®šé…ç½® ====================
if(CMAKE_BUILD_TYPE STREQUAL "Release")
    target_compile_definitions(vuforia_wrapper PRIVATE
        NDEBUG
        RELEASE
    )
    
    target_compile_options(vuforia_wrapper PRIVATE
        -O3
        -fomit-frame-pointer
        -ffunction-sections
        -fdata-sections
        -flto
    )
    
    # Release æ¨¡å¼ä¸‹çš„éˆæ¥å™¨å„ªåŒ–
    target_link_options(vuforia_wrapper PRIVATE
        -Wl,--gc-sections
        -Wl,--strip-all
        -flto
    )
    
    message(STATUS "Release mode: Full optimization enabled")
endif()

# ==================== éˆæ¥åº«é…ç½® ====================
target_link_libraries(vuforia_wrapper
    # Vuforia åº«ï¼ˆå¿…é ˆæ”¾åœ¨å‰é¢ï¼‰
    Vuforia
    
    # Android ç³»çµ±åº«
    ${log-lib}
    ${android-lib}
    
    # OpenGL ES ç›¸é—œ
    ${gles2-lib}
    ${egl-lib}
    
    # JNI ç›¸é—œ
    ${jnigraphics-lib}
    
    # ç›¸æ©Ÿç›¸é—œåº«ï¼ˆå¯é¸ï¼‰
    $<$<BOOL:${camera2-lib}>:${camera2-lib}>
    $<$<BOOL:${mediandk-lib}>:${mediandk-lib}>
    
    # å…¶ä»–ç³»çµ±åº«
    ${z-lib}
)

# ==================== ç‰¹å®šæ¶æ§‹å„ªåŒ– ====================
# ARM64 ç‰¹å®šå„ªåŒ–
if(ANDROID_ABI STREQUAL "arm64-v8a")
    target_compile_options(vuforia_wrapper PRIVATE
        -mcpu=cortex-a73
        -mtune=cortex-a73
    )
    message(STATUS "ARM64 optimizations enabled")
endif()

# ARMv7 ç‰¹å®šå„ªåŒ–
if(ANDROID_ABI STREQUAL "armeabi-v7a")
    target_compile_options(vuforia_wrapper PRIVATE
        -mcpu=cortex-a9
        -mtune=cortex-a9
        -mfloat-abi=softfp
    )
    message(STATUS "ARMv7 optimizations enabled")
endif()

# ==================== Vuforia ç‰¹å®šé…ç½®æª¢æŸ¥ ====================
# æª¢æŸ¥ Vuforia é ­æ–‡ä»¶æ˜¯å¦å­˜åœ¨
set(REQUIRED_VUFORIA_HEADERS
    "VuforiaEngine/VuforiaEngine.h"
    "VuforiaEngine/Core/Basic.h"
    "VuforiaEngine/Engine/Engine.h"
    "VuforiaEngine/Controller/CameraController.h"
    "VuforiaEngine/Observer/ImageTargetObserver.h"
)

foreach(HEADER ${REQUIRED_VUFORIA_HEADERS})
    if(NOT EXISTS "${VUFORIA_INCLUDE_DIR}/${HEADER}")
        message(WARNING "Required Vuforia header not found: ${HEADER}")
    else()
        message(STATUS "Found Vuforia header: ${HEADER}")
    endif()
endforeach()

# ==================== ç·¨è­¯æª¢æŸ¥ç›®æ¨™ ====================
# æ·»åŠ ç·¨è­¯æ™‚æª¢æŸ¥ï¼Œç¢ºä¿é—œéµJNIæ–¹æ³•å­˜åœ¨
add_custom_target(check-rendering-jni-methods
    COMMAND ${CMAKE_COMMAND} -E echo "ğŸ” Checking rendering JNI method completeness..."
    
    # æª¢æŸ¥é—œéµçš„æ¸²æŸ“æ–¹æ³•
    COMMAND grep -q "stopRenderingLoopNative" ${CMAKE_SOURCE_DIR}/*.cpp || echo "âš ï¸ WARNING: stopRenderingLoopNative method missing"
    COMMAND grep -q "startRenderingLoopNative" ${CMAKE_SOURCE_DIR}/*.cpp || echo "âš ï¸ WARNING: startRenderingLoopNative method missing"
    COMMAND grep -q "startCameraNative" ${CMAKE_SOURCE_DIR}/*.cpp || echo "âš ï¸ WARNING: startCameraNative method missing"
    COMMAND grep -q "stopCameraNative" ${CMAKE_SOURCE_DIR}/*.cpp || echo "âš ï¸ WARNING: stopCameraNative method missing"
    
    # æª¢æŸ¥Surfaceç®¡ç†æ–¹æ³•
    COMMAND grep -q "setSurfaceNative" ${CMAKE_SOURCE_DIR}/*.cpp || echo "âš ï¸ WARNING: setSurfaceNative method missing"
    COMMAND grep -q "onSurfaceCreatedNative" ${CMAKE_SOURCE_DIR}/*.cpp || echo "âš ï¸ WARNING: onSurfaceCreatedNative method missing"
    COMMAND grep -q "onSurfaceDestroyedNative" ${CMAKE_SOURCE_DIR}/*.cpp || echo "âš ï¸ WARNING: onSurfaceDestroyedNative method missing"
    
    COMMAND ${CMAKE_COMMAND} -E echo "âœ… JNI method check completed"
    COMMENT "Checking for required rendering JNI methods"
)

# è®“ä¸»ç›®æ¨™ä¾è³´æ–¼JNIæ–¹æ³•æª¢æŸ¥
#add_dependencies(vuforia_wrapper check-rendering-jni-methods)

# ==================== ç›¸æ©ŸåŠŸèƒ½æª¢æŸ¥ç›®æ¨™ ====================
add_custom_target(check-camera-features
    COMMAND ${CMAKE_COMMAND} -E echo "ğŸ“· Checking camera feature completeness..."
    
    # æª¢æŸ¥ç›¸æ©Ÿç›¸é—œæ–¹æ³•
    COMMAND grep -q "setupCameraBackgroundNative" ${CMAKE_SOURCE_DIR}/*.cpp || echo "âš ï¸ WARNING: setupCameraBackgroundNative method missing"
    COMMAND grep -q "startCameraNative" ${CMAKE_SOURCE_DIR}/*.cpp || echo "âš ï¸ WARNING: startCameraNative method missing"
    COMMAND grep -q "stopCameraNative" ${CMAKE_SOURCE_DIR}/*.cpp || echo "âš ï¸ WARNING: stopCameraNative method missing"
    COMMAND grep -q "isCameraActiveNative" ${CMAKE_SOURCE_DIR}/*.cpp || echo "âš ï¸ WARNING: isCameraActiveNative method missing"
    
    # æª¢æŸ¥ç›¸æ©Ÿæ¬Šé™ç›¸é—œä»£ç¢¼
    COMMAND grep -q "CAMERA_PERMISSION" ${CMAKE_SOURCE_DIR}/*.cpp || echo "â„¹ï¸ INFO: Camera permission handling not found"
    COMMAND grep -q "camera2" ${CMAKE_SOURCE_DIR}/*.cpp || echo "â„¹ï¸ INFO: Camera2 API usage not found"
    
    COMMAND ${CMAKE_COMMAND} -E echo "âœ… Camera feature check completed"
    COMMENT "Checking for required camera features"
)

# è®“ä¸»ç›®æ¨™ä¹Ÿä¾è³´æ–¼ç›¸æ©ŸåŠŸèƒ½æª¢æŸ¥
#add_dependencies(vuforia_wrapper check-camera-features)

# ==================== è‡ªå®šç¾©æ§‹å»ºç›®æ¨™ ====================
# æ¸…ç†ç›®æ¨™
add_custom_target(clean-vuforia
    COMMAND ${CMAKE_COMMAND} -E remove -f 
        ${CMAKE_BINARY_DIR}/libvuforia_wrapper.so
    COMMENT "Cleaning Vuforia wrapper library"
)

# é©—è­‰ç›®æ¨™ - æª¢æŸ¥ç”Ÿæˆçš„åº«
add_custom_target(verify-build
    COMMAND ${CMAKE_COMMAND} -E echo "Verifying build..."
    COMMAND test -f ${CMAKE_BINARY_DIR}/libvuforia_wrapper.so
    COMMAND ${CMAKE_COMMAND} -E echo "Build verification passed"
    DEPENDS vuforia_wrapper
    COMMENT "Verifying that the library was built correctly"
)

# ==================== æ¨¡çµ„åŒ–æ§‹å»ºé©—è­‰ ====================
# é©—è­‰æ¨¡çµ„åŒ–æ§‹å»ºæ˜¯å¦æ­£ç¢º
add_custom_target(verify-modular-build
    COMMAND ${CMAKE_COMMAND} -E echo "ğŸ” Verifying modular build structure..."
    COMMAND test -f ${CMAKE_BINARY_DIR}/libvuforia_wrapper.so || echo "âŒ Library not built"
    COMMAND ${CMAKE_COMMAND} -E echo "ğŸ“¦ Checking symbol exports..."
    # åœ¨Linux/Androidä¸Šå¯ä»¥æª¢æŸ¥ç¬¦è™Ÿ
    COMMAND nm -D ${CMAKE_BINARY_DIR}/libvuforia_wrapper.so | grep -q "stopRenderingLoopNative" || echo "âš ï¸ stopRenderingLoopNative symbol not found"
    COMMAND ${CMAKE_COMMAND} -E echo "âœ… Modular build verification completed"
    DEPENDS vuforia_wrapper
    COMMENT "Verifying that the modular build structure is correct"
)

# ==================== å®‰è£é…ç½® ====================
# è¨­ç½®å®‰è£ç›®éŒ„
set(CMAKE_INSTALL_PREFIX ${CMAKE_SOURCE_DIR}/../../../build/intermediates/cmake/${CMAKE_BUILD_TYPE}/obj/${ANDROID_ABI})

# å®‰è£ç”Ÿæˆçš„åº«
install(TARGETS vuforia_wrapper
    LIBRARY DESTINATION .
    COMPONENT Runtime
)

# ==================== æ€§èƒ½åˆ†ææ”¯æŒ ====================
# å¦‚æœå•Ÿç”¨äº†æ€§èƒ½åˆ†æ
option(ENABLE_PROFILING "Enable profiling support" OFF)
if(ENABLE_PROFILING)
    target_compile_definitions(vuforia_wrapper PRIVATE
        ENABLE_PROFILING=1
    )
    target_compile_options(vuforia_wrapper PRIVATE
        -pg
        -fno-omit-frame-pointer
    )
    target_link_options(vuforia_wrapper PRIVATE
        -pg
    )
    message(STATUS "Profiling support enabled")
endif()

# ==================== å…§å­˜æª¢æŸ¥æ”¯æŒ ====================
option(ENABLE_ASAN "Enable Address Sanitizer" OFF)
if(ENABLE_ASAN AND CMAKE_BUILD_TYPE STREQUAL "Debug")
    target_compile_options(vuforia_wrapper PRIVATE
        -fsanitize=address
        -fno-omit-frame-pointer
    )
    target_link_options(vuforia_wrapper PRIVATE
        -fsanitize=address
    )
    message(STATUS "Address Sanitizer enabled")
endif()

# ==================== ç·¨è­¯æ™‚é–“å„ªåŒ– ====================
# æ™ºèƒ½é ç·¨è­¯é ­æ–‡ä»¶é…ç½® - åŸºæ–¼ç¤¾ç¾¤æœ€ä½³å¯¦è¸
# æª¢æŸ¥æ˜¯å¦ä½¿ç”¨ clang ç·¨è­¯å™¨ä¸¦ä¸”ä¸æ˜¯ Android NDK ç’°å¢ƒ
if(CMAKE_VERSION VERSION_GREATER_EQUAL "3.16")
    # æª¢æŸ¥ç·¨è­¯å™¨é¡å‹
    if(CMAKE_CXX_COMPILER_ID STREQUAL "Clang" AND NOT ANDROID)
        target_precompile_headers(vuforia_wrapper PRIVATE
            <jni.h>
            <android/log.h>
            <string>
            <vector>
            <memory>
            <mutex>
        )
        message(STATUS "Precompiled headers enabled (Clang non-Android)")
        set(PCH_ENABLED TRUE)
    else()
        message(STATUS "Precompiled headers disabled (Android NDK compatibility)")
        set(PCH_ENABLED FALSE)
    endif()
else()
    message(STATUS "Precompiled headers disabled (CMake < 3.16)")
    set(PCH_ENABLED FALSE)
endif()

# ==================== éœæ…‹åˆ†ææ”¯æŒ ====================
# åªåœ¨æ²’æœ‰é ç·¨è­¯é ­æ–‡ä»¶è¡çªæ™‚å•Ÿç”¨ clang-tidy
find_program(CLANG_TIDY_EXE NAMES "clang-tidy")
if(CLANG_TIDY_EXE AND NOT PCH_ENABLED AND CMAKE_CXX_COMPILER_ID STREQUAL "Clang")
    set_target_properties(vuforia_wrapper PROPERTIES
        CXX_CLANG_TIDY "${CLANG_TIDY_EXE};-checks=-*,readability-*,performance-*,bugprone-*"
    )
    message(STATUS "clang-tidy static analysis enabled")
else()
    if(PCH_ENABLED)
        message(STATUS "clang-tidy disabled (conflicts with precompiled headers)")
    elseif(NOT CMAKE_CXX_COMPILER_ID STREQUAL "Clang")
        message(STATUS "clang-tidy disabled (requires Clang compiler)")
    else()
        message(STATUS "clang-tidy disabled (not found)")
    endif()
endif()

# ==================== ç”Ÿæˆ compile_commands.json ====================
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

# ==================== æ§‹å»ºä¿¡æ¯æ›´æ–° ====================
message(STATUS "ğŸ¯ Vuforia Rendering JNI Module Configuration:")
message(STATUS "   Main wrapper: vuforia_wrapper.cpp")
message(STATUS "   Rendering JNI: VuforiaRenderingJNI.cpp")
list(LENGTH VUFORIA_WRAPPER_SOURCES VUFORIA_SOURCE_COUNT)
message(STATUS "   Total source files: ${VUFORIA_SOURCE_COUNT}")
message(STATUS "   Build target: vuforia_wrapper (shared library)")
message(STATUS "ğŸ“· Camera Features:")
message(STATUS "   Camera2 NDK: $<$<BOOL:${camera2-lib}>:Available>$<$<NOT:$<BOOL:${camera2-lib}>>:Not Available>")
message(STATUS "   Media NDK: $<$<BOOL:${mediandk-lib}>:Available>$<$<NOT:$<BOOL:${mediandk-lib}>>:Not Available>")

# ==================== ç·¨è­¯è³‡è¨Šè¼¸å‡º ====================
# è¼¸å‡ºé‡è¦çš„ç·¨è­¯ä¿¡æ¯
message(STATUS "=== Vuforia Wrapper Build Configuration ===")
message(STATUS "CMake Version: ${CMAKE_VERSION}")
message(STATUS "C++ Standard: ${CMAKE_CXX_STANDARD}")
message(STATUS "Build Type: ${CMAKE_BUILD_TYPE}")
message(STATUS "Target ABI: ${ANDROID_ABI}")
message(STATUS "Android API Level: ${ANDROID_PLATFORM}")
message(STATUS "NDK Version: ${ANDROID_NDK_REVISION}")
message(STATUS "Vuforia Library: ${VUFORIA_LIBRARY_DIR}/libVuforia.so")
message(STATUS "==========================================")

# ==================== æœ€çµ‚é©—è­‰ ====================
# ç¢ºä¿æ‰€æœ‰å¿…éœ€çš„ä¾è³´éƒ½å·²æ‰¾åˆ°
get_target_property(VUFORIA_WRAPPER_LINK_LIBS vuforia_wrapper LINK_LIBRARIES)
message(STATUS "Linked libraries: ${VUFORIA_WRAPPER_LINK_LIBS}")

# è­¦å‘Šæª¢æŸ¥
if(NOT CMAKE_BUILD_TYPE STREQUAL "Release" AND NOT CMAKE_BUILD_TYPE STREQUAL "Debug")
    message(WARNING "Unusual build type: ${CMAKE_BUILD_TYPE}")
endif()

# æˆåŠŸé…ç½®æ¶ˆæ¯
message(STATUS "CMake configuration completed successfully!")
message(STATUS "Ready to build vuforia_wrapper library for ${ANDROID_ABI}")

# ==================== é–‹ç™¼è€…å¹«åŠ©ä¿¡æ¯æ›´æ–° ====================
message(STATUS "")
message(STATUS "ğŸ“‹ Available targets (Updated for modular structure):")
message(STATUS "  vuforia_wrapper           - Build the main library with rendering JNI")
message(STATUS "  check-rendering-jni-methods - Verify JNI method completeness")
message(STATUS "  check-camera-features     - Verify camera feature completeness")
message(STATUS "  verify-modular-build      - Verify modular build structure")
message(STATUS "  clean-vuforia            - Clean generated files")
message(STATUS "")
message(STATUS "ğŸ—ï¸ Build commands:")
message(STATUS "  ninja vuforia_wrapper               - Build complete library")
message(STATUS "  ninja check-rendering-jni-methods  - Check JNI methods")
message(STATUS "  ninja check-camera-features        - Check camera features")
message(STATUS "  ninja verify-modular-build         - Verify build output")
message(STATUS "")
message(STATUS "ğŸ“ File structure:")
message(STATUS "  VuforiaWrapper.h          - Main wrapper class declarations")
message(STATUS "  vuforia_wrapper.cpp       - Main wrapper implementation")
message(STATUS "  VuforiaRenderingJNI.h     - Rendering JNI declarations")
message(STATUS "  VuforiaRenderingJNI.cpp   - Rendering JNI implementation")
message(STATUS "")
message(STATUS "ğŸ“· Camera Features:")
message(STATUS "  Camera2 NDK support       - Hardware-accelerated camera access")
message(STATUS "  Media NDK support         - Media processing capabilities")
message(STATUS "  Camera permissions         - Runtime permission handling")
message(STATUS "")

# ==================== çµæŸ ====================